<!doctype html>
  <html>
  <head>
    <title> Anna's Word Game </title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nunito+Sans:wght@400;700&display=swap" rel="stylesheet">
    <style>

    body {
      font-family: 'Nunito Sans', sans-serif;
    }

    .game-row {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #answer {
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .answer-slot {
      width: 50px;
      height: 50px;
      border-bottom: 2px solid black;
      margin: 5px;
      font-size: 30px;
      font-weight: bold;
      text-align: center;
      display: flex;
      justify-content: center;
      align-items: flex-end;
    }

    .content {
      text-align: center;
      width: 95%;
      max-width: 800px;
      margin: auto;
    }

    .game-box {
      max-width: 20%;
      width: 80px;
      height: 80px;
      border: 4px solid black;
      font-size: 30px;
      font-weight: bold;
      text-align: center;
      display: flex;
      justify-content: center;
      align-items: center;
      cursor: default;
      border-left: none;
      border-top: none;
    }

    .game-box-top {
      border-top: 4px solid black;
    }

    .game-box-first {
      border-left: 4px solid black;
    }

    .unclicked {
      cursor: pointer;
    }

    .unclicked:hover {
      background-color: #eeeeee;
    }

    .clicked {
      background-color: #B04C4C;
      color: white;
    }

    .present {
      background-color: #4CB053;
      color: white;
    }
    </style>
  </head>
  <body>
  <div class = "content">
  <h1> word sweep </h1>
  <p> <strong>How it works: </strong>Click letters to guess the word like hangman. But, after clicking, a number is revealed giving you the minimum distance on the board to another nearest letter in the word. There are no diagonals in the distance and the distance is calculated from the remaining hidden letters. </p>
  <div id = "game">
  </div>

  <div id = "answer">
  </div>
  </div>
  <script>

  let  word = JSON.parse(httpGet("https://random-word-api.herokuapp.com/word?number=1"))[0];

  /*while(word.length > 8) {
    word = httpGet("https://random-word-api.herokuapp.com/word?number=1");
  }*/
  //word = "reading"
  play(word);

  function play(word) {
    var g_audio = new Audio('good-sound.wav');
    var b_audio = new Audio('bad-sound.wav');
    g_audio.volume = 0.2;
    b_audio.volume = 0.2;
    let gameArea = document.getElementById("game");

    let answer_spots = {};

    let answer = document.getElementById("answer");

    for(let i = 0; i < word.length; i++) {
      if(!(word[i] in answer_spots)) {
        answer_spots[word[i]] = [];
      }
      let box = document.createElement("div");
      box.classList.add("answer-slot");
      answer.appendChild(box);
      answer_spots[word[i]].push(box);
    }

    let letters = ["a", "b", "c", "d", "e","f","g","h", "i", "j", "k", "l", "m", "n", "o", "p", "q","r","s","t","u","v","w","x","y","z"];
    let guess_i = [];
    shuffle(letters, word);

    for(let i = 0; i < 5; i++) {
      let row = document.createElement("div");
      row.classList.add("game-row");
      for(let j = 0; j < 5; j++) {
        let box = document.createElement("div");
        box.classList.add("game-box");
        box.classList.add("unclicked");
        box.onclick = (e) => {clicked(e,i*5+j)};
        box.textContent = letters[i*5+j];
        row.appendChild(box);

        if(j == 0) {
          box.classList.add("game-box-first");
        }
        if(i == 0) {
          box.classList.add("game-box-top");
        }
      }
      gameArea.appendChild(row);
    }
    function clicked(e,letter) {
      console.log(e);
      console.log(letter);

      let x1 = letter % 5;
      let y1 = Math.floor(letter / 5);

      distances = [];
      for (let i = 0; i < word.length; i++) {
        let index = letters.indexOf(word[i]);
        if(!guess_i.includes(index)) {
          let x2 = index % 5;
          let y2 = Math.floor(index / 5);

          distances.push(Math.abs(x1 - x2) + Math.abs(y1 - y2));
        }
      }
      guess_i.push(letter);

      e.target.classList.remove("unclicked");

      if(word.includes(letters[letter])) {
        g_audio.play();
        e.target.classList.add("present");
        answer_spots[letters[letter]].forEach((item) => {
          item.textContent = letters[letter];
        })
      } else {
        b_audio.play();
        e.target.classList.add("clicked");
      }

      e.target.textContent = Math.min.apply(null,distances.filter(i => i != 0));
      e.target.textContent = e.target.textContent.replace("Infinity","âˆž");
    }

    function shuffle(input) {
      letters.sort(() => Math.random() - 0.5);
      while(word.includes(input[input.length - 1])) {
        letters.sort(() => Math.random() - 0.5);
      }
    }
  }




  function httpGet(theUrl)
  {
    var xmlHttp = new XMLHttpRequest();
    xmlHttp.open( "GET", theUrl, false ); // false for synchronous request
    xmlHttp.send( null );
    return xmlHttp.responseText;
  }

  </script>
  </body>
</html>
